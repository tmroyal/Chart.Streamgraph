// CSS COLOR PARSER CODE
//
// (c) Dean McNamee <dean@gmail.com>, 2012.
//
// https://github.com/deanm/css-color-parser-js
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to
// deal in the Software without restriction, including without limitation the
// rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
// sell copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
// FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
// IN THE SOFTWARE.
// http://www.w3.org/TR/css3-color/
var cssColorParser=function(){function t(e){return e=Math.round(e),e<0?0:e>255?255:e}function n(e){return e<0?0:e>1?1:e}function r(e){return e[e.length-1]==="%"?t(parseFloat(e)/100*255):t(parseInt(e))}function i(e){return e[e.length-1]==="%"?n(parseFloat(e)/100):n(parseFloat(e))}function s(e,t,n){return n<0?n+=1:n>1&&(n-=1),n*6<1?e+(t-e)*n*6:n*2<1?t:n*3<2?e+(t-e)*(2/3-n)*6:e}function o(n){var o=n.replace(/ /g,"").toLowerCase();if(o in e)return e[o].slice();if(o[0]==="#"){if(o.length===4){var u=parseInt(o.substr(1),16);return u>=0&&u<=4095?[(u&3840)>>4|(u&3840)>>8,u&240|(u&240)>>4,u&15|(u&15)<<4,1]:null}if(o.length===7){var u=parseInt(o.substr(1),16);return u>=0&&u<=16777215?[(u&16711680)>>16,(u&65280)>>8,u&255,1]:null}return null}var a=o.indexOf("("),f=o.indexOf(")");if(a!==-1&&f+1===o.length){var l=o.substr(0,a),c=o.substr(a+1,f-(a+1)).split(","),h=1;switch(l){case"rgba":if(c.length!==4)return null;h=i(c.pop());case"rgb":if(c.length!==3)return null;return[r(c[0]),r(c[1]),r(c[2]),h];case"hsla":if(c.length!==4)return null;h=i(c.pop());case"hsl":if(c.length!==3)return null;var p=(parseFloat(c[0])%360+360)%360/360,d=i(c[1]),v=i(c[2]),m=v<=.5?v*(d+1):v+d-v*d,g=v*2-m;return[t(s(g,m,p+1/3)*255),t(s(g,m,p)*255),t(s(g,m,p-1/3)*255),h];default:return null}}return null}var e={rebeccapurple:[102,51,153],transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};return o}();(function(){"use strict";function e(e){throw Error("Chart.Streamgraph: "+e)}function t(t){t.length||e("dataset must be an array"),(!t[0].data||!t[0].data.length)&&e("dataset must have array value data");var n=t[0].data.length;for(var r=1;r<t.length;r++){(!t[r].data||!t[r].data.length)&&e("dataset must have array value data");if(n!==t[r].data.length)return!1}return!0}function n(e,t){var n={};return D.extend(n,e),n.data=[],D.each(e.data,function(e){n.data.push({x:t,width:e})}),n}function r(e){var t=[];return D.each(e,function(e,r){t.push(n(e,r))}),t}function i(e){D.each(e,function(e){var t=!1,n=0;e.onset=0,e.sum=0,e.maxWidth=0,e.maxWidthIndex=0,e.secondWidthIndex=0;for(var r=0;r<e.data.length;r++)n=e.data[r].width,t||(e.onset=r),n>0&&(t=!0),e.sum+=n,n>=e.maxWidth&&(e.maxWidth=n,e.secondWidthIndex=e.maxWidthIndex,e.maxWidthIndex=r)})}function s(e){var t=[],n=[],r=0,i=0;return D.each(e,function(e){r<i?(t.push(e),r+=1):(n.push(e),i+=1)}),n.concat(t)}function o(e){var t=e[0].data.length,n=e.length,r=[];for(var i=0;i<t;i++){var s=0;for(var o=0;o<n;o++)s+=(n-o-.5)*e[o].data[i].width;s/=n,r.push(s)}return r}function u(e,t){var n=t.slice();D.each(e,function(e){D.each(e.data,function(e,t){e.y1=n[t],e.y0=e.y1-e.width,n[t]=e.y0})})}function a(e){var t=Infinity,n=-Infinity;for(var r=0;r<e.length;r++)for(var i=0;i<e[r].data.length;i++)e[r].data[i].y0>n&&(n=e[r].data[i].y0),e[r].data[i].y1<t&&(t=e[r].data[i].y1);return{min:t,max:n}}function f(e,t){var n=[];for(var r=0;r<e.length;r++)n.push({top:{x:t.calculateX(r),y:t.calculateY(e[r].y0)},bottom:{x:t.calculateX(r),y:t.calculateY(e[r].y1)+1}});return n}function l(e,t,n){for(var r=0;r<e.length;r++){var i=e[r-2>=0?r-2:0][t],s=e[r-1>=0?r-1:0][t],o=e[r][t],u=e[r+1<e.length?r+1:e.length-1][t],a=(o.x-i.x)/n,f=(o.y-i.y)/n,l=(u.x-s.x)/n,c=(u.y-s.y)/n;o.ctlPoints={p1:{x:s.x+a,y:s.y+f},p2:{x:o.x-l,y:o.y-c}}}return e}function c(e,t){t||(t=.5),t<=0&&(t=1e-5),t>1&&(t=1);var n=-6/(t-1);return l(e,"top",n),e.reverse(),l(e,"bottom",n),e.reverse(),e}function h(e,t,n,r){var i=e.points=f(e.data,n),s,o,u;s=e.onset>0?e.onset-1:0,o=i[s].top,t.beginPath(),t.moveTo(o.x,o.y);if(r.curve){c(i,r.curveTension);for(u=s+1;u<i.length;u++)o=i[u].top,t.bezierCurveTo(o.ctlPoints.p1.x,o.ctlPoints.p1.y,o.ctlPoints.p2.x,o.ctlPoints.p2.y,o.x,o.y);o=i[i.length-1].bottom,t.lineTo(o.x,o.y);for(u=i.length-2;u>=s;u--)o=i[u].bottom,t.bezierCurveTo(o.ctlPoints.p1.x,o.ctlPoints.p1.y,o.ctlPoints.p2.x,o.ctlPoints.p2.y,o.x,o.y)}else{for(u=s+1;u<i.length;u++)o=i[u].top,t.lineTo(o.x,o.y);for(u=i.length-1;u>=s;u--)o=i[u].bottom,t.lineTo(o.x,o.y)}e.hover&&r.colorHighlight?t.fillStyle=e.hoverColor:t.fillStyle=e.color,r.stroke&&(t.strokeStyle=r.strokeColor,t.lineWidth=r.strokeWidth,t.stroke()),t.fill()}function p(e,t,n,r){var i;r.labelPlacementMethod==="maxHeight"?i=v(e,t,n,r):i=d(e,t,n,r),i.point&&(t.font=D.fontString(i.size,r.labelFontStyle,r.labelFontFamily),t.textAlign=r.labelPlacementMethod==="maxHeight"?"center":"left",t.textBaseline=r.labelPlacementMethod==="maxHeight"?"middle":"hanging",t.fillStyle=e.textColor||r.labelFontColor,t.fillText(e.label,i.point.x,i.point.y))}function d(e,t,n,r){var i,s,o,u,a,f,l,c,h,p,d=0,m,g,y=e.points,b=t.canvas.width;for(var w=0;w<y.length;w++){i=y[w],s=i.bottom.y-i.top.y,o=s*.5;if(o>=r.labelMinimumSize&&o>=d&&i.top.x>=0){l=s*.25,u=i.top.y+l,a=i.bottom.y-l,f=!1,m={x:i.top.x,y:u},p=o,t.textBaseline="top",t.font=D.fontString(o,r.labelFontStyle,r.labelFontFamily),c=t.measureText(e.label).width,h=0;var E=w+1;while(h<c&&!f&&E<y.length&&i.top.x<b){i=y[E];if(i.bottom.y<a||i.top.y>u)f=!0;h+=n.valueWidth,E++}h>c&&!f&&(g=m,d=p)}}return!g&&r.labelPlacementMethod==="idealThenMaxHeight"?v(e,t,n,r):{point:g,size:r.labelFixedSize||d}}function v(e,t,n,r){var i=e.maxWidthIndex,s=n.calculateX(i),o=e.data[i],u=n.calculateY(o.y0+o.width*.5),a;return r.labelFixedSize?(s=m(s,r.labelFixedSize,t,e,r),{point:{x:s,y:u},size:r.labelFixedSize}):(a=(n.calculateY(1)-n.calculateY(0))*o.width*.4,a>=r.labelMinimumSize?(s=m(s,r.labelFixedSize,t,e,r),{point:{x:s,y:u},size:a}):{})}function m(e,t,n,r,i){var s,o=n.canvas.width-10;n.font=D.fontString(t,i.labelFontStyle,i.labelFontFamily),s=n.measureText(r.label).width;while(e+s*2>o)e-=s*2,console.log("called",r.label,e);return e}function g(e,t,n,r){D.each(e,function(e){h(e,t,n,r)}),r.labels&&D.each(e,function(e){p(e,t,n,r)})}function y(e,t,n,r){return e=b(e,0,255),t=b(t,0,255),n=b(n,0,255),r=b(r,0,255),"rgba("+Math.floor(e)+","+Math.floor(t)+","+Math.floor(n)+","+r+")"}function b(e,t,n){return Math.max(t,Math.min(e,n))}function w(e,t,n){return t*n+e*(1-n)}function E(e,t){var n=t.colorAssignmentMethod,r=e.concat();return n==="maxHeight"?r.sort(function(e,t){return t.maxWidth-e.maxWidth}):n==="sum"?r.sort(function(e,t){return t.sum-e.sum}):r}function S(e,t,n){var r=t*n,i=Math.floor(r),s=r-i,o=i+1;return o>e.length-1&&(o=i),{r:w(e[i][0],e[o][0],s),g:w(e[i][1],e[o][1],s),b:w(e[i][2],e[o][2],s),a:w(e[i][3],e[o][3],s)}}function x(e,t,n){var r=Math.floor(t*n);return{r:e[r][0],g:e[r][1],b:e[r][2],a:e[r][3]}}function T(e,t){var n=t%e.length;return{r:e[n][0],g:e[n][1],b:e[n][2],a:e[n][3]}}function N(e,t){return e*=t,e>255?255:e}function C(e,t){return{r:N(e.r,t.colorHighlightMultiplier),g:N(e.g,t.colorHighlightMultiplier),b:N(e.b,t.colorHighlightMultiplier),a:e.a}}function k(e){var t=cssColorParser(e);return{r:t[0],g:t[1],b:t[2],a:t[3]}}function L(e,t,n){var r=[],i,s;n.colorInterpolation==="gradient"?(s=S,i=(e.length-1)/(t.length-1)):n.colorInterpolation==="cycle"?s=T:(s=x,i=e.length/t.length);var o=E(t,n),u,a;for(var f=0;f<o.length;f++)o[f].fillColor?o[f].highlightColor?(o[f].color=o[f].fillColor,o[f].hoverColor=o[f].highlightColor):(u=k(o[f].fillColor),a=C(u,n),o[f].color=y(u.r,u.g,u.b,u.a),o[f].hoverColor=y(a.r,a.g,a.b,a.a)):(u=s(e,f,i),a=C(u,n),o[f].color=y(u.r,u.g,u.b,u.a),o[f].hoverColor=y(a.r,a.g,a.b,a.a));return t}function A(e,t,n){return Math.floor((e-t)/n)}function O(e,t,n){var r=!1;for(var i=0,s=n.length-1;i<n.length;s=i++){var o=n[i].x,u=n[i].y,a=n[s].x,f=n[s].y,l=u>t!=f>t&&e<(a-o)*(t-u)/(f-u)+o;l&&(r=!r)}return r}function M(e,t,n,r){if(n<r.onset)return!1;n>0&&(n-=1);var i=n+2;i>r.points.length-1&&(i=r.point.length-1);var s=r.points,o=[s[n].top,s[n].bottom,s[i].bottom,s[i].top];return O(e,t,o)}function _(e){return Math.round(e*100)/100}var D=Chart.helpers,P={backgroundColor:"#fff",stroke:!0,strokeWidth:2,strokeColor:"rgb(255,255,255)",scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,0.1)",scaleGridLineWidth:1,scaleShowHorizontalLines:!0,scaleShowVerticalLines:!0,scaleDivisions:6,curve:!0,curveTension:.1,colorInterpolation:"gradient",colors:["rgba(220,220,220,0.9)","rgba(151,187,205,0.9)"],colorHighlight:!0,colorHighlightMultiplier:.92,colorAssignmentMethod:"verticalPosition",labels:!0,labelFixedSize:!1,labelMinimumSize:12,labelFontFamily:'"HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif',labelFontStyle:"normal",labelFontColor:"rgba(64,64,64,0.5)",labelPlacementMethod:"ideal",multiTooltipTemplate:"x:<%= xLabel %> y:<%= value %>"};Chart.Type.extend({name:"Streamgraph",defaults:P,initialize:function(n){this.layerColors=this.options.colors.map(function(e){return cssColorParser(e)}),t(n.datasets)||e("all datasets must be same length"),this.layers=r(n.datasets),i(this.layers),this.layers=s(this.layers),this.baseline=o(this.layers),u(this.layers,this.baseline),L(this.layerColors,this.layers,this.options),this.hover=-1,this.hoverIndex=-1,this.options.showTooltips&&this.options.colorHighlight&&D.bindEvents(this,this.options.tooltipEvents,function(e){var t=!1,r=D.getRelativePosition(e),i=-1,s=-1,o=this.scale.width-(this.scale.xScalePaddingLeft+this.scale.xScalePaddingRight),u=o/Math.max(this.scale.valuesCount-(this.scale.offsetGridLines?0:1),1),a=A(r.x+1,this.scale.xScalePaddingLeft,u);for(var f=0;f<this.layers.length;f++)!this.layers[f].points||t||a>this.layers[f].points.length-2?this.layers[f].hover=!1:M(r.x,r.y,a,this.layers[f])?(t=this.layers[f].hover=!0,i=f,s=a):this.layers[f].hover=!1;if(this.hover!==i||this.hoverIndex!==s){this.hover=i,this.hoverIndex=s,this.draw();if(t&&this.options.showTooltips){var l=D.template(this.options.multiTooltipTemplate,{x:s,xLabel:n.labels[s],value:_(this.layers[i].data[s].width),sum:_(this.layers[i].sum),maxWidth:_(this.layers[i].maxWidth),tooltipData:this.layers[i].tooltipData});(new Chart.MultiTooltip({x:this.scale.calculateX(a),y:r.y,xPadding:this.options.tooltipXPadding,yPadding:this.options.tooltipYPadding,xOffset:this.options.tooltipXOffset,fillColor:this.options.tooltipFillColor,textColor:this.options.tooltipFontColor,fontFamily:this.options.tooltipFontFamily,fontStyle:this.options.tooltipFontStyle,fontSize:this.options.tooltipFontSize,titleTextColor:this.options.tooltipTitleFontColor,titleFontFamily:this.options.tooltipTitleFontFamily,titleFontStyle:this.options.tooltipTitleFontStyle,titleFontSize:this.options.tooltipTitleFontSize,cornerRadius:this.options.tooltipCornerRadius,labels:[l],legendColors:[{fill:this.layers[this.hover].hoverColor,stroke:this.layers[this.hover].hoverColor}],legendColorBackground:this.options.multiTooltipKeyBackground,title:this.layers[this.hover].label,chart:this.chart,ctx:this.chart.ctx,custom:this.options.customTooltips})).draw()}}}.bind(this)),this.buildScale(n.labels,this.options),this.render()},generateLegend:function(){console.error("Chart.Streamgraph: legend generation not supported")},update:function(){this.render()},buildScale:function(e,t){var n=this,r={templateString:"<%= Math.abs(Math.round(value*100)/100) %>",height:this.chart.height,width:this.chart.width,ctx:this.chart.ctx,textColor:this.options.scaleFontColor,fontSize:this.options.scaleFontSize,fontStyle:this.options.scaleFontStyle,fontFamily:this.options.scaleFontFamily,valuesCount:e.length,beginAtZero:this.options.scaleBeginAtZero,integersOnly:this.options.scaleIntegersOnly,calculateYRange:function(){var e=a(n.layers),r=Math.floor(Math.max(Math.abs(e.min),Math.abs(e.max))*1.5);e={min:r,max:-r};var i=e.max-e.min;D.extend(this,e),D.extend(this,{steps:t.scaleDivisions,stepValue:i/t.scaleDivisions})},xLabels:e,font:D.fontString(this.options.scaleFontSize,this.options.scaleFontStyle,this.options.scaleFontFamily),lineWidth:this.options.scaleLineWidth,lineColor:this.options.scaleLineColor,showHorizontalLines:this.options.scaleShowHorizontalLines,showVerticalLines:this.options.scaleShowHorizontalLines,gridLineWidth:this.options.scaleShowGridLines?this.options.scaleGridLineWidth:0,gridLineColor:this.options.scaleShowGridLines?this.options.scaleGridLineColor:"rgba(0,0,0,0)",padding:2,showLabels:this.options.scaleShowLabels,display:this.options.showScale};this.options.scaleOverride&&(this.options.scaleStepWidth=-Math.abs(this.options.scaleStepWidth),this.options.scaleStartValue=-this.options.scaleStartValue,D.extend(r,{calculateYRange:D.noop,steps:this.options.scaleSteps,stepValue:this.options.scaleStepWidth,min:this.options.scaleStartValue,max:this.options.scaleStartValue+this.options.scaleSteps*this.options.scaleStepWidth})),this.scale=new Chart.Scale(r),this.scale.innerWidth=this.scale.width-(this.scale.xScalePaddingLeft+this.scale.xScalePaddingRight),this.scale.valueWidth=this.scale.innerWidth/Math.max(this.scale.valuesCount-(this.scale.offsetGridLines?0:1),1)},reflow:function(){this.scale.update({width:this.chart.width,height:this.chart.height})},draw:function(){var e=this.chart.ctx;e.fillStyle=this.options.backgroundColor,e.fillRect(0,0,this.chart.width,this.chart.height),this.scale.draw(),g(this.layers,e,this.scale,this.options)}})})();